<div class="main-container">
  <app-database></app-database>
  <app-header></app-header>
  <!-- Contenu principal du Dashboard -->
  <div class="main-content">
    <div class="fullscreen-dashboard">
      <div class="form-card">
        <h2 class="form-title"><i class="fas fa-chart-line"></i> Analyse de collection</h2>

        <!-- Message d'erreur -->
        <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

        <!-- Indicateur de chargement -->
        <div *ngIf="isLoading" class="loading">
          <i class="fas fa-spinner fa-spin"></i> Chargement...
        </div>

        <!-- Formulaire -->
        <div class="form-container">
          <!-- Sélection du mode d'affichage -->
          <div class="form-group">
            <label for="displayMode" class="form-label">Mode d'affichage :</label>
            <div class="select-wrapper">
              <select
                id="displayMode"
                [(ngModel)]="displayMode"
                (ngModelChange)="onDisplayModeChange()"
                name="displayMode"
                class="form-select"
              >
                <option value="chart">Graphique</option>
                <option value="table">Tableau</option>
              </select>
              <i class="fas fa-chevron-down select-icon"></i>
            </div>
          </div>

          <!-- Sélection de la collection -->
          <div class="form-group">
            <label for="collectionSelect" class="form-label">Collection :</label>
            <div class="select-wrapper">
              <select
                id="collectionSelect"
                [(ngModel)]="selectedCollection"
                (ngModelChange)="onCollectionSelect()"
                name="collectionSelect"
                [disabled]="!databaseName"
                class="form-select"
              >
                <option value="" disabled>Sélectionnez une collection</option>
                <option *ngFor="let col of collections" [value]="col">{{ col }}</option>
              </select>
              <i class="fas fa-chevron-down select-icon"></i>
            </div>
          </div>

          <!-- Sélection du champ -->
          <div class="form-group" *ngIf="fieldNames.length > 0">
            <label for="fieldSelect" class="form-label">Champ :</label>
            <div class="select-wrapper">
              <select
                id="fieldSelect"
                [(ngModel)]="selectedField"
                (ngModelChange)="onFieldChange()"
                name="fieldSelect"
                class="form-select"
              >
                <option value="" disabled>Sélectionnez un champ</option>
                <option *ngFor="let field of fieldNames" [value]="field">{{ field }}</option>
              </select>
              <i class="fas fa-chevron-down select-icon"></i>
            </div>
          </div>
        </div>

        <!-- Conteneur du graphique -->
        <div class="chart-container" *ngIf="showChart && displayMode === 'chart'">
          <div #chart class="chart"></div>
        </div>

        <!-- Conteneur du tableau -->
        <div class="table-container" *ngIf="displayMode === 'table' && hasData()">
          <table class="data-table">
            <thead>
              <tr>
                <th *ngFor="let column of visibleColumns">
                  {{ column }}
                  <i
                    class="fas fa-times remove-column"
                    (click)="removeColumn(column)"
                    title="Supprimer la colonne"
                  ></i>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td *ngFor="let column of visibleColumns">{{ groupedCountResult[column] || '-' }}</td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Message si aucune donnée -->
        <div class="no-data" *ngIf="displayMode === 'table' && !hasData()">
          Aucune donnée à afficher dans le tableau.
        </div>
      </div>
    </div>
  </div>
</div>
